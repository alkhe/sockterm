(function(){function s(){this._events=this._events||{}}function d(a,e,b){var c=this;if(!(this instanceof d))return new d(a,e,b);s.call(this);"number"===typeof a&&(a={cols:a,rows:e,handler:b});a=a||{};y(z(d.defaults),function(b){null==a[b]&&(a[b]=d.options[b],d[b]!==d.defaults[b]&&(a[b]=d[b]));c[b]=a[b]});8===a.colors.length?a.colors=a.colors.concat(d._colors.slice(8)):16===a.colors.length?a.colors=a.colors.concat(d._colors.slice(16)):10===a.colors.length?a.colors=a.colors.slice(0,-2).concat(d._colors.slice(8,
-2),a.colors.slice(-2)):18===a.colors.length&&(a.colors=a.colors.slice(0,-2).concat(d._colors.slice(16,-2),a.colors.slice(-2)));this.colors=a.colors;this.options=a;this.parent=a.body||a.parent||(A?A.getElementsByTagName("body")[0]:null);this.cols=a.cols||a.geometry[0];this.rows=a.rows||a.geometry[1];if(a.handler)this.on("data",a.handler);this.cursorState=this.y=this.x=this.ydisp=this.ybase=0;this.cursorHidden=!1;this.convertEol;this.state=0;this.queue="";this.scrollTop=0;this.scrollBottom=this.rows-
1;this.wraparoundMode=this.insertMode=this.originMode=this.applicationCursor=this.applicationKeypad=!1;this.normal=null;this.searchMode=this.visualMode=this.selectMode=this.prefixMode=!1;this.searchDown;this.entry="";this.entryPrefix="Search: ";this._real;this._selected;this._textarea;this.gcharset=this.charset=null;this.glevel=0;this.charsets=[null];this.decLocator;this.x10Mouse;this.vt200Mouse;this.vt300Mouse;this.normalMouse;this.mouseEvents;this.sendFocus;this.utfMouse;this.sgrMouse;this.urxvtMouse;
this.element;this.children;this.refreshStart;this.refreshEnd;this.savedX;this.savedY;this.savedCols;this.writable=this.readable=!0;this.curAttr=this.defAttr=131840;this.params=[];this.currentParam=0;this.postfix=this.prefix="";this.lines=[];for(e=this.rows;e--;)this.lines.push(this.blankLine());this.tabs;this.setupStops()}function r(a,e,b,c){a.addEventListener(e,b,c||!1)}function w(a,e,b,c){a.removeEventListener(e,b,c||!1)}function q(a){a.preventDefault&&a.preventDefault();a.returnValue=!1;a.stopPropagation&&
a.stopPropagation();a.cancelBubble=!0;return!1}function B(a,e){function b(){this.constructor=a}b.prototype=e.prototype;a.prototype=new b}function D(a){var e=a.getElementsByTagName("body")[0];a=a.createElement("span");a.innerHTML="hello world";e.appendChild(a);var b=a.scrollWidth;a.style.fontWeight="bold";var c=a.scrollWidth;e.removeChild(a);return b!==c}function x(a){return"\uff00">=a?!1:"\uff01"<=a&&"\uffbe">=a||"\uffc2"<=a&&"\uffc7">=a||"\uffca"<=a&&"\uffcf">=a||"\uffd2"<=a&&"\uffd7">=a||"\uffda"<=
a&&"\uffdc">=a||"\uffe0"<=a&&"\uffe6">=a||"\uffe8"<=a&&"\uffee">=a}function u(a,e,b){var c=a<<16|e<<8|b;if(null!=u._cache[c])return u._cache[c];for(var p=Infinity,h=-1,f=0,g,l,k;f<d.vcolors.length;f++){g=d.vcolors[f];l=g[0];k=g[1];g=g[2];l=u.distance(a,e,b,l,k,g);if(0===l){h=f;break}l<p&&(p=l,h=f)}return u._cache[c]=h}function y(a,e,b){if(a.forEach)return a.forEach(e,b);for(var c=0;c<a.length;c++)e.call(b,a[c],c,a)}function z(a){if(Object.keys)return Object.keys(a);var e,b=[];for(e in a)Object.prototype.hasOwnProperty.call(a,
e)&&b.push(e);return b}var A=this.document;s.prototype.addListener=function(a,e){this._events[a]=this._events[a]||[];this._events[a].push(e)};s.prototype.on=s.prototype.addListener;s.prototype.removeListener=function(a,e){if(this._events[a])for(var b=this._events[a],c=b.length;c--;)if(b[c]===e||b[c].listener===e){b.splice(c,1);break}};s.prototype.off=s.prototype.removeListener;s.prototype.removeAllListeners=function(a){this._events[a]&&delete this._events[a]};s.prototype.once=function(a,e){function b(){var c=
Array.prototype.slice.call(arguments);this.removeListener(a,b);return e.apply(this,c)}b.listener=e;return this.on(a,b)};s.prototype.emit=function(a){if(this._events[a])for(var e=Array.prototype.slice.call(arguments,1),b=this._events[a],c=b.length,d=0;d<c;d++)b[d].apply(this,e)};s.prototype.listeners=function(a){return this._events[a]=this._events[a]||[]};B(d,s);d.prototype.eraseAttr=function(){return this.defAttr&-512|this.curAttr&511};d.tangoColors="#2e3436 #cc0000 #4e9a06 #c4a000 #3465a4 #75507b #06989a #d3d7cf #555753 #ef2929 #8ae234 #fce94f #729fcf #ad7fa8 #34e2e2 #eeeeec".split(" ");
d.xtermColors="#000000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5 #7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" ");d.colors=function(){function a(a,c,d){b.push("#"+e(a)+e(c)+e(d))}function e(a){a=a.toString(16);return 2>a.length?"0"+a:a}var b=d.tangoColors.slice(),c=[0,95,135,175,215,255],p;for(p=0;216>p;p++)a(c[p/36%6|0],c[p/6%6|0],c[p%6]);for(p=0;24>p;p++)c=8+10*p,a(c,c,c);return b}();d.colors[256]="#000000";d.colors[257]="#f0f0f0";d._colors=d.colors.slice();
d.vcolors=function(){for(var a=[],e=d.colors,b=0,c;256>b;b++)c=parseInt(e[b].substring(1),16),a.push([c>>16&255,c>>8&255,c&255]);return a}();d.defaults={colors:d.colors,convertEol:!1,termName:"xterm",geometry:[80,24],cursorBlink:!0,visualBell:!1,popOnBell:!1,scrollback:1E3,screenKeys:!1,debug:!1,useStyle:!1};d.options={};y(z(d.defaults),function(a){d[a]=d.defaults[a];d.options[a]=d.defaults[a]});d.focus=null;d.prototype.focus=function(){d.focus!==this&&(d.focus&&d.focus.blur(),this.sendFocus&&this.send("\u001b[I"),
this.showCursor(),d.focus=this)};d.prototype.blur=function(){d.focus===this&&(this.cursorState=0,this.refresh(this.y,this.y),this.sendFocus&&this.send("\u001b[O"),d.focus=null)};d.prototype.initGlobal=function(){var a=this.document;d._boundDocs=d._boundDocs||[];var e;a:{e=d._boundDocs;for(var b=e.length;b--;)if(e[b]===a){e=b;break a}e=-1}~e||(d._boundDocs.push(a),d.bindPaste(a),d.bindKeys(a),d.bindCopy(a),this.isMobile&&this.fixMobile(a),this.useStyle&&d.insertStyle(a,this.colors[256],this.colors[257]))};
d.bindPaste=function(a){r(a.defaultView,"paste",function(a){var b=d.focus;if(b)return a.clipboardData?b.send(a.clipboardData.getData("text/plain")):b.context.clipboardData&&b.send(b.context.clipboardData.getData("Text")),b.element.contentEditable="inherit",q(a)})};d.bindKeys=function(a){r(a,"keydown",function(a){if(d.focus){var b=a.target||a.srcElement;if(b&&(b===d.focus.element||b===d.focus.context||b===d.focus.document||b===d.focus.body||b===d._textarea||b===d.focus.parent))return d.focus.keyDown(a)}},
!0);r(a,"keypress",function(a){if(d.focus){var b=a.target||a.srcElement;if(b&&(b===d.focus.element||b===d.focus.context||b===d.focus.document||b===d.focus.body||b===d._textarea||b===d.focus.parent))return d.focus.keyPress(a)}},!0);r(a,"mousedown",function(a){if(d.focus&&(a=a.target||a.srcElement)){do if(a===d.focus.element)return;while(a=a.parentNode);d.focus.blur()}})};d.bindCopy=function(a){r(a.defaultView,"copy",function(a){var b=d.focus;if(b&&b._selected){a=b.getCopyTextarea();var c=b.grabText(b._selected.x1,
b._selected.x2,b._selected.y1,b._selected.y2);b.emit("copy",c);a.focus();a.textContent=c;a.value=c;a.setSelectionRange(0,c.length);v(function(){b.element.focus();b.focus()},1)}})};d.prototype.fixMobile=function(a){var e=this,b=a.createElement("textarea");b.style.position="absolute";b.style.left="-32000px";b.style.top="-32000px";b.style.width="0px";b.style.height="0px";b.style.opacity="0";b.style.backgroundColor="transparent";b.style.borderStyle="none";b.style.outlineStyle="none";b.autocapitalize=
"none";b.autocorrect="off";a.getElementsByTagName("body")[0].appendChild(b);d._textarea=b;v(function(){b.focus()},1E3);this.isAndroid&&r(b,"change",function(){var a=b.textContent||b.value;b.value="";b.textContent="";e.send(a+"\r")})};d.insertStyle=function(a,e,b){var c=a.getElementById("term-style");if(!c){var d=a.getElementsByTagName("head")[0];d&&(c=a.createElement("style"),c.id="term-style",c.innerHTML=".terminal {\n  float: left;\n  border: "+e+' solid 5px;\n  font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;\n  font-size: 11px;\n  color: '+
b+";\n  background: "+e+";\n}\n\n.terminal-cursor {\n  color: "+e+";\n  background: "+b+";\n}\n",d.insertBefore(c,d.firstChild))}};d.prototype.open=function(a){var e=this,b=0;this.parent=a||this.parent;if(!this.parent)throw Error("Terminal requires a parent element.");this.context=this.parent.ownerDocument.defaultView;this.document=this.parent.ownerDocument;this.body=this.document.getElementsByTagName("body")[0];this.context.navigator&&this.context.navigator.userAgent&&(this.isMac=!!~this.context.navigator.userAgent.indexOf("Mac"),
this.isIpad=!!~this.context.navigator.userAgent.indexOf("iPad"),this.isIphone=!!~this.context.navigator.userAgent.indexOf("iPhone"),this.isAndroid=!!~this.context.navigator.userAgent.indexOf("Android"),this.isMobile=this.isIpad||this.isIphone||this.isAndroid,this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE"));this.element=this.document.createElement("div");this.element.className="terminal";this.element.style.outline="none";this.element.setAttribute("tabindex",0);this.element.setAttribute("spellcheck",
"false");this.element.style.backgroundColor=this.colors[256];this.element.style.color=this.colors[257];for(this.children=[];b<this.rows;b++)a=this.document.createElement("div"),this.element.appendChild(a),this.children.push(a);this.parent.appendChild(this.element);this.refresh(0,this.rows-1);this.initGlobal();this.focus();this.startBlink();r(this.element,"focus",function(){e.focus();e.isMobile&&d._textarea.focus()});r(this.element,"mousedown",function(){e.focus()});r(this.element,"mousedown",function(a){a=
null!=a.button?+a.button:null!=a.which?a.which-1:null;e.isMSIE&&(a=1===a?0:4===a?1:a);2===a&&(e.element.contentEditable="true",v(function(){e.element.contentEditable="inherit"},1))},!0);this.bindMouse();null==d.brokenBold&&(d.brokenBold=D(this.document));v(function(){e.element.focus()},100)};d.prototype.bindMouse=function(){function a(a){var b,e,h,l;switch(a.type){case "mousedown":b=null!=a.button?+a.button:null!=a.which?a.which-1:null;f.isMSIE&&(b=1===b?0:4===b?1:b);break;case "mouseup":b=3;break;
case "DOMMouseScroll":b=0>a.detail?64:65;break;case "mousewheel":b=0<a.wheelDeltaY?64:65}h=a.shiftKey?4:0;l=a.metaKey?8:0;e=a.ctrlKey?16:0;h=h|l|e;f.vt200Mouse?h&=e:f.normalMouse||(h=0);b=32+(h<<2)+b;if(e=d(a))switch(c(b,e),a.type){case "mousedown":g=b;break;case "mouseup":g=32}}function e(a){var b=g;(a=d(a))&&c(b+32,a)}function b(a,b){if(f.utfMouse){if(2047===b)return a.push(0);127>b?a.push(b):(2047<b&&(b=2047),a.push(192|b>>6),a.push(128|b&63))}else{if(255===b)return a.push(0);127<b&&(b=127);a.push(b)}}
function c(a,c){if(f.vt300Mouse){a&=3;c.x-=32;c.y-=32;var e="\u001b[24";if(0===a)e+="1";else if(1===a)e+="3";else if(2===a)e+="5";else{if(3===a)return;e+="0"}e+="~["+c.x+","+c.y+"]\r";f.send(e)}else f.decLocator?(a&=3,c.x-=32,c.y-=32,0===a?a=2:1===a?a=4:2===a?a=6:3===a&&(a=3),f.send("\u001b["+a+";"+(3===a?4:0)+";"+c.y+";"+c.x+";"+(c.page||0)+"&w")):f.urxvtMouse?(c.x-=32,c.y-=32,c.x++,c.y++,f.send("\u001b["+a+";"+c.x+";"+c.y+"M")):f.sgrMouse?(c.x-=32,c.y-=32,f.send("\u001b[<"+(3===(a&3)?a&-4:a)+";"+
c.x+";"+c.y+(3===(a&3)?"m":"M"))):(e=[],b(e,a),b(e,c.x),b(e,c.y),f.send("\u001b[M"+t.fromCharCode.apply(t,e)))}function d(a){var b,c,e,g;if(null!=a.pageX){b=a.pageX;c=a.pageY;for(e=f.element;e&&e!==f.document.documentElement;)b-=e.offsetLeft,c-=e.offsetTop,e="offsetParent"in e?e.offsetParent:e.parentNode;e=f.element.clientWidth;g=f.element.clientHeight;b=Math.round(b/e*f.cols);c=Math.round(c/g*f.rows);0>b&&(b=0);b>f.cols&&(b=f.cols);0>c&&(c=0);c>f.rows&&(c=f.rows);return{x:b+32,y:c+32,type:a.type===
l?"mousewheel":a.type}}}var h=this.element,f=this,g=32,l="onmousewheel"in this.context?"mousewheel":"DOMMouseScroll";r(h,"mousedown",function(b){if(f.mouseEvents){a(b);f.focus();if(f.vt200Mouse)return a({__proto__:b,type:"mouseup"}),q(b);f.normalMouse&&r(f.document,"mousemove",e);f.x10Mouse||r(f.document,"mouseup",function m(b){a(b);f.normalMouse&&w(f.document,"mousemove",e);w(f.document,"mouseup",m);return q(b)});return q(b)}});r(h,l,function(b){if(f.mouseEvents&&!(f.x10Mouse||f.vt300Mouse||f.decLocator))return a(b),
q(b)});r(h,l,function(a){if(!f.mouseEvents&&!f.applicationKeypad)return"DOMMouseScroll"===a.type?f.scrollDisp(0>a.detail?-5:5):f.scrollDisp(0<a.wheelDeltaY?-5:5),q(a)})};d.prototype.destroy=function(){this.writable=this.readable=!1;this._events={};this.handler=function(){};this.write=function(){};this.element.parentNode&&this.element.parentNode.removeChild(this.element)};d.prototype.refresh=function(a,e){var b,c,p,h,f,g,l,k,n,m,q,r;e-a>=this.rows/2&&(r=this.element.parentNode)&&r.removeChild(this.element);
l=this.cols;c=a;e>=this.lines.length&&(this.log("`end` is too large. Most likely a bad CSR."),e=this.lines.length-1);for(;c<=e;c++){b=c+this.ydisp;h=this.lines[b];f="";b=c!==this.y||!this.cursorState||this.ydisp!==this.ybase&&!this.selectMode||this.cursorHidden?-1:this.x;n=this.defAttr;for(p=0;p<l;p++){k=h[p][0];g=h[p][1];p===b&&(k=-1);k!==n&&(n!==this.defAttr&&(f+="</span>"),k!==this.defAttr&&(-1===k?f+='<span class="reverse-video terminal-cursor">':(f+='<span style="',n=k&511,m=k>>9&511,q=k>>18,
q&1&&(d.brokenBold||(f+="font-weight:bold;"),8>m&&(m+=8)),q&2&&(f+="text-decoration:underline;"),q&4&&(q&2?(f=f.slice(0,-1),f+=" blink;"):f+="text-decoration:blink;"),q&8&&(n=k>>9&511,m=k&511,q&1&&8>m&&(m+=8)),q&16&&(f+="visibility:hidden;"),256!==n&&(f+="background-color:"+this.colors[n]+";"),257!==m&&(f+="color:"+this.colors[m]+";"),f+='">')));switch(g){case "&":f+="&amp;";break;case "<":f+="&lt;";break;case ">":f+="&gt;";break;default:" ">=g?f+="&nbsp;":(x(g)&&p++,f+=g)}n=k}n!==this.defAttr&&(f+=
"</span>");this.children[c].innerHTML=f}r&&r.appendChild(this.element)};d.prototype._cursorBlink=function(){d.focus===this&&(this.cursorState^=1,this.refresh(this.y,this.y))};d.prototype.showCursor=function(){this.cursorState||(this.cursorState=1,this.refresh(this.y,this.y))};d.prototype.startBlink=function(){if(this.cursorBlink){var a=this;this._blinker=function(){a._cursorBlink()};this._blink=C(this._blinker,500)}};d.prototype.refreshBlink=function(){this.cursorBlink&&(clearInterval(this._blink),
this._blink=C(this._blinker,500))};d.prototype.scroll=function(){var a;++this.ybase===this.scrollback&&(this.ybase=this.ybase/2|0,this.lines=this.lines.slice(-(this.ybase+this.rows)+1));this.ydisp=this.ybase;a=this.ybase+this.rows-1;a-=this.rows-1-this.scrollBottom;a===this.lines.length?this.lines.push(this.blankLine()):this.lines.splice(a,0,this.blankLine());0!==this.scrollTop&&(0!==this.ybase&&(this.ybase--,this.ydisp=this.ybase),this.lines.splice(this.ybase+this.scrollTop,1));this.updateRange(this.scrollTop);
this.updateRange(this.scrollBottom)};d.prototype.scrollDisp=function(a){this.ydisp+=a;this.ydisp>this.ybase?this.ydisp=this.ybase:0>this.ydisp&&(this.ydisp=0);this.refresh(0,this.rows-1)};d.prototype.write=function(a){var e=a.length,b=0,c;this.refreshEnd=this.refreshStart=this.y;this.ybase!==this.ydisp&&(this.ydisp=this.ybase,this.maxRange());for(;b<e;b++)switch(c=a[b],this.state){case 0:switch(c){case "\u0007":this.bell();break;case "\n":case "\x0B":case "\f":this.convertEol&&(this.x=0);this.y++;
this.y>this.scrollBottom&&(this.y--,this.scroll());break;case "\r":this.x=0;break;case "\b":0<this.x&&this.x--;break;case "\t":this.x=this.nextStop();break;case "\u000e":this.setgLevel(1);break;case "\u000f":this.setgLevel(0);break;case "\u001b":this.state=1;break;default:if(" "<=c&&(this.charset&&this.charset[c]&&(c=this.charset[c]),this.x>=this.cols&&(this.x=0,this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll())),this.lines[this.y+this.ybase][this.x]=[this.curAttr,c],this.x++,this.updateRange(this.y),
x(c))){c=this.y+this.ybase;if(2>this.cols||this.x>=this.cols){this.lines[c][this.x-1]=[this.curAttr," "];break}this.lines[c][this.x]=[this.curAttr," "];this.x++}}break;case 1:switch(c){case "[":this.params=[];this.currentParam=0;this.state=2;break;case "]":this.params=[];this.currentParam=0;this.state=3;break;case "P":this.params=[];this.currentParam=0;this.state=5;break;case "_":this.state=6;break;case "^":this.state=6;break;case "c":this.reset();break;case "E":this.x=0;case "D":this.index();break;
case "M":this.reverseIndex();break;case "%":this.setgLevel(0);this.setgCharset(0,d.charsets.US);this.state=0;b++;break;case "(":case ")":case "*":case "+":case "-":case ".":switch(c){case "(":this.gcharset=0;break;case ")":this.gcharset=1;break;case "*":this.gcharset=2;break;case "+":this.gcharset=3;break;case "-":this.gcharset=1;break;case ".":this.gcharset=2}this.state=4;break;case "/":this.gcharset=3;this.state=4;b--;break;case "N":break;case "O":break;case "n":this.setgLevel(2);break;case "o":this.setgLevel(3);
break;case "|":this.setgLevel(3);break;case "}":this.setgLevel(2);break;case "~":this.setgLevel(1);break;case "7":this.saveCursor();this.state=0;break;case "8":this.restoreCursor();this.state=0;break;case "#":this.state=0;b++;break;case "H":this.tabSet();break;case "=":this.log("Serial port requested application keypad.");this.applicationKeypad=!0;this.state=0;break;case ">":this.log("Switching back to normal keypad.");this.applicationKeypad=!1;this.state=0;break;default:this.state=0,this.error("Unknown ESC control: %s.",
c)}break;case 4:switch(c){case "0":c=d.charsets.SCLD;break;case "A":c=d.charsets.UK;break;case "B":c=d.charsets.US;break;case "4":c=d.charsets.Dutch;break;case "C":case "5":c=d.charsets.Finnish;break;case "R":c=d.charsets.French;break;case "Q":c=d.charsets.FrenchCanadian;break;case "K":c=d.charsets.German;break;case "Y":c=d.charsets.Italian;break;case "E":case "6":c=d.charsets.NorwegianDanish;break;case "Z":c=d.charsets.Spanish;break;case "H":case "7":c=d.charsets.Swedish;break;case "=":c=d.charsets.Swiss;
break;case "/":c=d.charsets.ISOLatin;b++;break;default:c=d.charsets.US}this.setgCharset(this.gcharset,c);this.gcharset=null;this.state=0;break;case 3:if("\u001b"===c||"\u0007"===c){"\u001b"===c&&b++;this.params.push(this.currentParam);switch(this.params[0]){case 0:case 1:case 2:this.params[1]&&(this.title=this.params[1],this.handleTitle(this.title))}this.params=[];this.state=this.currentParam=0}else this.params.length?this.currentParam+=c:"0"<=c&&"9">=c?this.currentParam=10*this.currentParam+c.charCodeAt(0)-
48:";"===c&&(this.params.push(this.currentParam),this.currentParam="");break;case 2:if("?"===c||">"===c||"!"===c){this.prefix=c;break}if("0"<=c&&"9">=c){this.currentParam=10*this.currentParam+c.charCodeAt(0)-48;break}if("$"===c||'"'===c||" "===c||"'"===c){this.postfix=c;break}this.params.push(this.currentParam);this.currentParam=0;if(";"===c)break;this.state=0;switch(c){case "A":this.cursorUp(this.params);break;case "B":this.cursorDown(this.params);break;case "C":this.cursorForward(this.params);break;
case "D":this.cursorBackward(this.params);break;case "H":this.cursorPos(this.params);break;case "J":this.eraseInDisplay(this.params);break;case "K":this.eraseInLine(this.params);break;case "m":this.prefix||this.charAttributes(this.params);break;case "n":this.prefix||this.deviceStatus(this.params);break;case "@":this.insertChars(this.params);break;case "E":this.cursorNextLine(this.params);break;case "F":this.cursorPrecedingLine(this.params);break;case "G":this.cursorCharAbsolute(this.params);break;
case "L":this.insertLines(this.params);break;case "M":this.deleteLines(this.params);break;case "P":this.deleteChars(this.params);break;case "X":this.eraseChars(this.params);break;case "`":this.charPosAbsolute(this.params);break;case "a":this.HPositionRelative(this.params);break;case "c":this.sendDeviceAttributes(this.params);break;case "d":this.linePosAbsolute(this.params);break;case "e":this.VPositionRelative(this.params);break;case "f":this.HVPosition(this.params);break;case "h":this.setMode(this.params);
break;case "l":this.resetMode(this.params);break;case "r":this.setScrollRegion(this.params);break;case "s":this.saveCursor(this.params);break;case "u":this.restoreCursor(this.params);break;case "I":this.cursorForwardTab(this.params);break;case "S":this.scrollUp(this.params);break;case "T":2>this.params.length&&!this.prefix&&this.scrollDown(this.params);break;case "Z":this.cursorBackwardTab(this.params);break;case "b":this.repeatPrecedingCharacter(this.params);break;case "g":this.tabClear(this.params);
break;case "p":switch(this.prefix){case "!":this.softReset(this.params)}break;default:this.error("Unknown CSI code: %s.",c)}this.postfix=this.prefix="";break;case 5:if("\u001b"===c||"\u0007"===c){"\u001b"===c&&b++;switch(this.prefix){case "":break;case "$q":c=this.currentParam;var p=!1;switch(c){case '"q':c='0"q';break;case '"p':c='61"p';break;case "r":c=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";break;case "m":c="0m";break;default:this.error("Unknown DCS Pt: %s.",c),c=""}this.send("\u001bP"+
+p+"$r"+c+"\u001b\\");break;case "+p":break;case "+q":c=this.currentParam;p=!1;this.send("\u001bP"+ +p+"+r"+c+"\u001b\\");break;default:this.error("Unknown DCS prefix: %s.",this.prefix)}this.currentParam=0;this.prefix="";this.state=0}else this.currentParam?this.currentParam+=c:this.prefix||"$"===c||"+"===c?2===this.prefix.length?this.currentParam=c:this.prefix+=c:this.currentParam=c;break;case 6:if("\u001b"===c||"\u0007"===c)"\u001b"===c&&b++,this.state=0}this.updateRange(this.y);this.refresh(this.refreshStart,
this.refreshEnd)};d.prototype.writeln=function(a){this.write(a+"\r\n")};d.prototype.keyDown=function(a){var e=this,b;switch(a.keyCode){case 8:if(a.shiftKey){b="\b";break}b="\u007f";break;case 9:if(a.shiftKey){b="\u001b[Z";break}b="\t";break;case 13:b="\r";break;case 27:b="\u001b";break;case 37:if(this.applicationCursor){b="\u001bOD";break}b="\u001b[D";break;case 39:if(this.applicationCursor){b="\u001bOC";break}b="\u001b[C";break;case 38:if(this.applicationCursor){b="\u001bOA";break}if(a.ctrlKey)return this.scrollDisp(-1),
q(a);b="\u001b[A";break;case 40:if(this.applicationCursor){b="\u001bOB";break}if(a.ctrlKey)return this.scrollDisp(1),q(a);b="\u001b[B";break;case 46:b="\u001b[3~";break;case 45:b="\u001b[2~";break;case 36:if(this.applicationKeypad){b="\u001bOH";break}b="\u001bOH";break;case 35:if(this.applicationKeypad){b="\u001bOF";break}b="\u001bOF";break;case 33:if(a.shiftKey)return this.scrollDisp(-(this.rows-1)),q(a);b="\u001b[5~";break;case 34:if(a.shiftKey)return this.scrollDisp(this.rows-1),q(a);b="\u001b[6~";
break;case 112:b="\u001bOP";break;case 113:b="\u001bOQ";break;case 114:b="\u001bOR";break;case 115:b="\u001bOS";break;case 116:b="\u001b[15~";break;case 117:b="\u001b[17~";break;case 118:b="\u001b[18~";break;case 119:b="\u001b[19~";break;case 120:b="\u001b[20~";break;case 121:b="\u001b[21~";break;case 122:b="\u001b[23~";break;case 123:b="\u001b[24~";break;default:if(a.ctrlKey)if(65<=a.keyCode&&90>=a.keyCode){if(this.screenKeys&&!this.prefixMode&&!this.selectMode&&65===a.keyCode)return this.enterPrefix(),
q(a);if(this.prefixMode&&86===a.keyCode){this.leavePrefix();return}if((this.prefixMode||this.selectMode)&&67===a.keyCode){this.visualMode&&v(function(){e.leaveVisual()},1);return}b=t.fromCharCode(a.keyCode-64)}else 32===a.keyCode?b=t.fromCharCode(0):51<=a.keyCode&&55>=a.keyCode?b=t.fromCharCode(a.keyCode-51+27):56===a.keyCode?b=t.fromCharCode(127):219===a.keyCode?b=t.fromCharCode(27):221===a.keyCode&&(b=t.fromCharCode(29));else if(!this.isMac&&a.altKey||this.isMac&&a.metaKey)65<=a.keyCode&&90>=a.keyCode?
b="\u001b"+t.fromCharCode(a.keyCode+32):192===a.keyCode?b="\u001b`":48<=a.keyCode&&57>=a.keyCode&&(b="\u001b"+(a.keyCode-48))}if(!b)return!0;if(this.prefixMode)return this.leavePrefix(),q(a);if(this.selectMode)return this.keySelect(a,b),q(a);this.emit("keydown",a);this.emit("key",b,a);this.showCursor();this.handler(b);return q(a)};d.prototype.setgLevel=function(a){this.glevel=a;this.charset=this.charsets[a]};d.prototype.setgCharset=function(a,e){this.charsets[a]=e;this.glevel===a&&(this.charset=e)};
d.prototype.keyPress=function(a){var e;q(a);if(a.charCode)e=a.charCode;else if(null==a.which)e=a.keyCode;else if(0!==a.which&&0!==a.charCode)e=a.which;else return!1;if(!e||a.ctrlKey||a.altKey||a.metaKey)return!1;e=t.fromCharCode(e);if(this.prefixMode)return this.leavePrefix(),this.keyPrefix(a,e),!1;if(this.selectMode)return this.keySelect(a,e),!1;this.emit("keypress",e,a);this.emit("key",e,a);this.showCursor();this.handler(e);return!1};d.prototype.send=function(a){var e=this;this.queue||v(function(){e.handler(e.queue);
e.queue=""},1);this.queue+=a};d.prototype.bell=function(){this.emit("bell");if(this.visualBell){var a=this;this.element.style.borderColor="white";v(function(){a.element.style.borderColor=""},10);this.popOnBell&&this.focus()}};d.prototype.log=function(){if(this.debug&&this.context.console&&this.context.console.log){var a=Array.prototype.slice.call(arguments);this.context.console.log.apply(this.context.console,a)}};d.prototype.error=function(){if(this.debug&&this.context.console&&this.context.console.error){var a=
Array.prototype.slice.call(arguments);this.context.console.error.apply(this.context.console,a)}};d.prototype.resize=function(a,e){var b,c,d;1>a&&(a=1);1>e&&(e=1);d=this.cols;if(d<a)for(c=[this.defAttr," "],b=this.lines.length;b--;)for(;this.lines[b].length<a;)this.lines[b].push(c);else if(d>a)for(b=this.lines.length;b--;)for(;this.lines[b].length>a;)this.lines[b].pop();this.setupStops(d);this.cols=a;d=this.rows;if(d<e)for(c=this.element;d++<e;)this.lines.length<e+this.ybase&&this.lines.push(this.blankLine()),
this.children.length<e&&(b=this.document.createElement("div"),c.appendChild(b),this.children.push(b));else if(d>e)for(;d-- >e;)this.lines.length>e+this.ybase&&this.lines.pop(),this.children.length>e&&(c=this.children.pop())&&c.parentNode.removeChild(c);this.rows=e;this.y>=e&&(this.y=e-1);this.x>=a&&(this.x=a-1);this.scrollTop=0;this.scrollBottom=e-1;this.refresh(0,this.rows-1);this.normal=null};d.prototype.updateRange=function(a){a<this.refreshStart&&(this.refreshStart=a);a>this.refreshEnd&&(this.refreshEnd=
a)};d.prototype.maxRange=function(){this.refreshStart=0;this.refreshEnd=this.rows-1};d.prototype.setupStops=function(a){null!=a?this.tabs[a]||(a=this.prevStop(a)):(this.tabs={},a=0);for(;a<this.cols;a+=8)this.tabs[a]=!0};d.prototype.prevStop=function(a){null==a&&(a=this.x);for(;!this.tabs[--a]&&0<a;);return a>=this.cols?this.cols-1:0>a?0:a};d.prototype.nextStop=function(a){null==a&&(a=this.x);for(;!this.tabs[++a]&&a<this.cols;);return a>=this.cols?this.cols-1:0>a?0:a};d.prototype.eraseRight=function(a,
e){for(var b=this.lines[this.ybase+e],c=[this.eraseAttr()," "];a<this.cols;a++)b[a]=c;this.updateRange(e)};d.prototype.eraseLeft=function(a,e){var b=this.lines[this.ybase+e],c=[this.eraseAttr()," "];for(a++;a--;)b[a]=c;this.updateRange(e)};d.prototype.eraseLine=function(a){this.eraseRight(0,a)};d.prototype.blankLine=function(a){a=[a?this.eraseAttr():this.defAttr," "];for(var e=[],b=0;b<this.cols;b++)e[b]=a;return e};d.prototype.ch=function(a){return a?[this.eraseAttr()," "]:[this.defAttr," "]};d.prototype.is=
function(a){return 0===(this.termName+"").indexOf(a)};d.prototype.handler=function(a){this.emit("data",a)};d.prototype.handleTitle=function(a){this.emit("title",a)};d.prototype.index=function(){this.y++;this.y>this.scrollBottom&&(this.y--,this.scroll());this.state=0};d.prototype.reverseIndex=function(){var a;this.y--;this.y<this.scrollTop&&(this.y++,this.lines.splice(this.y+this.ybase,0,this.blankLine(!0)),a=this.rows-1-this.scrollBottom,this.lines.splice(this.rows-1+this.ybase-a+1,1),this.updateRange(this.scrollTop),
this.updateRange(this.scrollBottom));this.state=0};d.prototype.reset=function(){this.options.rows=this.rows;this.options.cols=this.cols;d.call(this,this.options);this.refresh(0,this.rows-1)};d.prototype.tabSet=function(){this.tabs[this.x]=!0;this.state=0};d.prototype.cursorUp=function(a){a=a[0];1>a&&(a=1);this.y-=a;0>this.y&&(this.y=0)};d.prototype.cursorDown=function(a){a=a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&(this.y=this.rows-1)};d.prototype.cursorForward=function(a){a=a[0];1>a&&(a=1);this.x+=
a;this.x>=this.cols&&(this.x=this.cols-1)};d.prototype.cursorBackward=function(a){a=a[0];1>a&&(a=1);this.x-=a;0>this.x&&(this.x=0)};d.prototype.cursorPos=function(a){var e;e=a[0]-1;a=2<=a.length?a[1]-1:0;0>e?e=0:e>=this.rows&&(e=this.rows-1);0>a?a=0:a>=this.cols&&(a=this.cols-1);this.x=a;this.y=e};d.prototype.eraseInDisplay=function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);for(a=this.y+1;a<this.rows;a++)this.eraseLine(a);break;case 1:this.eraseLeft(this.x,this.y);for(a=this.y;a--;)this.eraseLine(a);
break;case 2:for(a=this.rows;a--;)this.eraseLine(a)}};d.prototype.eraseInLine=function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y)}};d.prototype.charAttributes=function(a){if(1===a.length&&0===a[0])this.curAttr=this.defAttr;else{for(var e=a.length,b=0,c=this.curAttr>>18,d=this.curAttr>>9&511,h=this.curAttr&511,f;b<e;b++)f=a[b],30<=f&&37>=f?d=f-30:40<=f&&47>=f?h=f-40:90<=f&&97>=f?(f+=8,d=f-90):100<=f&&107>=f?(f+=
8,h=f-100):0===f?(c=this.defAttr>>18,d=this.defAttr>>9&511,h=this.defAttr&511):1===f?c|=1:4===f?c|=2:5===f?c|=4:7===f?c|=8:8===f?c|=16:22===f?c&=-2:24===f?c&=-3:25===f?c&=-5:27===f?c&=-9:28===f?c&=-17:39===f?d=this.defAttr>>9&511:49===f?h=this.defAttr&511:38===f?2===a[b+1]?(b+=2,d=u(a[b]&255,a[b+1]&255,a[b+2]&255),-1===d&&(d=511),b+=2):5===a[b+1]&&(b+=2,d=f=a[b]&255):48===f?2===a[b+1]?(b+=2,h=u(a[b]&255,a[b+1]&255,a[b+2]&255),-1===h&&(h=511),b+=2):5===a[b+1]&&(b+=2,h=f=a[b]&255):100===f?(d=this.defAttr>>
9&511,h=this.defAttr&511):this.error("Unknown SGR attribute: %d.",f);this.curAttr=c<<18|d<<9|h}};d.prototype.deviceStatus=function(a){if(!this.prefix)switch(a[0]){case 5:this.send("\u001b[0n");break;case 6:this.send("\u001b["+(this.y+1)+";"+(this.x+1)+"R")}else if("?"===this.prefix)switch(a[0]){case 6:this.send("\u001b[?"+(this.y+1)+";"+(this.x+1)+"R")}};d.prototype.insertChars=function(a){var e,b,c;a=a[0];1>a&&(a=1);e=this.y+this.ybase;b=this.x;for(c=[this.eraseAttr()," "];a--&&b<this.cols;)this.lines[e].splice(b++,
0,c),this.lines[e].pop()};d.prototype.cursorNextLine=function(a){a=a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&(this.y=this.rows-1);this.x=0};d.prototype.cursorPrecedingLine=function(a){a=a[0];1>a&&(a=1);this.y-=a;0>this.y&&(this.y=0);this.x=0};d.prototype.cursorCharAbsolute=function(a){a=a[0];1>a&&(a=1);this.x=a-1};d.prototype.insertLines=function(a){var e,b;a=a[0];1>a&&(a=1);e=this.y+this.ybase;b=this.rows-1-this.scrollBottom;for(b=this.rows-1+this.ybase-b+1;a--;)this.lines.splice(e,0,this.blankLine(!0)),
this.lines.splice(b,1);this.updateRange(this.y);this.updateRange(this.scrollBottom)};d.prototype.deleteLines=function(a){var e,b;a=a[0];1>a&&(a=1);e=this.y+this.ybase;b=this.rows-1-this.scrollBottom;for(b=this.rows-1+this.ybase-b;a--;)this.lines.splice(b+1,0,this.blankLine(!0)),this.lines.splice(e,1);this.updateRange(this.y);this.updateRange(this.scrollBottom)};d.prototype.deleteChars=function(a){var e,b;a=a[0];1>a&&(a=1);e=this.y+this.ybase;for(b=[this.eraseAttr()," "];a--;)this.lines[e].splice(this.x,
1),this.lines[e].push(b)};d.prototype.eraseChars=function(a){var e,b,c;a=a[0];1>a&&(a=1);e=this.y+this.ybase;b=this.x;for(c=[this.eraseAttr()," "];a--&&b<this.cols;)this.lines[e][b++]=c};d.prototype.charPosAbsolute=function(a){a=a[0];1>a&&(a=1);this.x=a-1;this.x>=this.cols&&(this.x=this.cols-1)};d.prototype.HPositionRelative=function(a){a=a[0];1>a&&(a=1);this.x+=a;this.x>=this.cols&&(this.x=this.cols-1)};d.prototype.sendDeviceAttributes=function(a){0<a[0]||(this.prefix?">"===this.prefix&&(this.is("xterm")?
this.send("\u001b[>0;276;0c"):this.is("rxvt-unicode")?this.send("\u001b[>85;95;0c"):this.is("linux")?this.send(a[0]+"c"):this.is("screen")&&this.send("\u001b[>83;40003;0c")):this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")?this.send("\u001b[?1;2c"):this.is("linux")&&this.send("\u001b[?6c"))};d.prototype.linePosAbsolute=function(a){a=a[0];1>a&&(a=1);this.y=a-1;this.y>=this.rows&&(this.y=this.rows-1)};d.prototype.VPositionRelative=function(a){a=a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&
(this.y=this.rows-1)};d.prototype.HVPosition=function(a){1>a[0]&&(a[0]=1);1>a[1]&&(a[1]=1);this.y=a[0]-1;this.y>=this.rows&&(this.y=this.rows-1);this.x=a[1]-1;this.x>=this.cols&&(this.x=this.cols-1)};d.prototype.setMode=function(a){if("object"===typeof a)for(var e=a.length,b=0;b<e;b++)this.setMode(a[b]);else if(!this.prefix)switch(a){case 4:this.insertMode=!0}else if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!0;break;case 2:this.setgCharset(0,d.charsets.US);this.setgCharset(1,d.charsets.US);
this.setgCharset(2,d.charsets.US);this.setgCharset(3,d.charsets.US);break;case 3:this.savedCols=this.cols;this.resize(132,this.rows);break;case 6:this.originMode=!0;break;case 7:this.wraparoundMode=!0;break;case 66:this.log("Serial port requested application keypad.");this.applicationKeypad=!0;break;case 9:case 1E3:case 1002:case 1003:this.x10Mouse=9===a;this.vt200Mouse=1E3===a;this.normalMouse=1E3<a;this.mouseEvents=!0;this.element.style.cursor="default";this.log("Binding to mouse events.");break;
case 1004:this.sendFocus=!0;break;case 1005:this.utfMouse=!0;break;case 1006:this.sgrMouse=!0;break;case 1015:this.urxvtMouse=!0;break;case 25:this.cursorHidden=!1;break;case 1049:case 47:case 1047:this.normal||(a={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs},this.reset(),this.normal=a,this.showCursor())}};d.prototype.resetMode=function(a){if("object"===typeof a)for(var e=a.length,b=0;b<e;b++)this.resetMode(a[b]);
else if(!this.prefix)switch(a){case 4:this.insertMode=!1}else if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!1;break;case 3:132===this.cols&&this.savedCols&&this.resize(this.savedCols,this.rows);delete this.savedCols;break;case 6:this.originMode=!1;break;case 7:this.wraparoundMode=!1;break;case 66:this.log("Switching back to normal keypad.");this.applicationKeypad=!1;break;case 9:case 1E3:case 1002:case 1003:this.mouseEvents=this.normalMouse=this.vt200Mouse=this.x10Mouse=!1;this.element.style.cursor=
"";break;case 1004:this.sendFocus=!1;break;case 1005:this.utfMouse=!1;break;case 1006:this.sgrMouse=!1;break;case 1015:this.urxvtMouse=!1;break;case 25:this.cursorHidden=!0;break;case 1049:case 47:case 1047:this.normal&&(this.lines=this.normal.lines,this.ybase=this.normal.ybase,this.ydisp=this.normal.ydisp,this.x=this.normal.x,this.y=this.normal.y,this.scrollTop=this.normal.scrollTop,this.scrollBottom=this.normal.scrollBottom,this.tabs=this.normal.tabs,this.normal=null,this.refresh(0,this.rows-1),
this.showCursor())}};d.prototype.setScrollRegion=function(a){this.prefix||(this.scrollTop=(a[0]||1)-1,this.scrollBottom=(a[1]||this.rows)-1,this.y=this.x=0)};d.prototype.saveCursor=function(a){this.savedX=this.x;this.savedY=this.y};d.prototype.restoreCursor=function(a){this.x=this.savedX||0;this.y=this.savedY||0};d.prototype.cursorForwardTab=function(a){for(a=a[0]||1;a--;)this.x=this.nextStop()};d.prototype.scrollUp=function(a){for(a=a[0]||1;a--;)this.lines.splice(this.ybase+this.scrollTop,1),this.lines.splice(this.ybase+
this.scrollBottom,0,this.blankLine());this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};d.prototype.scrollDown=function(a){for(a=a[0]||1;a--;)this.lines.splice(this.ybase+this.scrollBottom,1),this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine());this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};d.prototype.initMouseTracking=function(a){};d.prototype.resetTitleModes=function(a){};d.prototype.cursorBackwardTab=function(a){for(a=a[0]||1;a--;)this.x=this.prevStop()};
d.prototype.repeatPrecedingCharacter=function(a){a=a[0]||1;for(var e=this.lines[this.ybase+this.y],b=e[this.x-1]||[this.defAttr," "];a--;)e[this.x++]=b};d.prototype.tabClear=function(a){a=a[0];0>=a?delete this.tabs[this.x]:3===a&&(this.tabs={})};d.prototype.mediaCopy=function(a){};d.prototype.setResources=function(a){};d.prototype.disableModifiers=function(a){};d.prototype.setPointerMode=function(a){};d.prototype.softReset=function(a){this.applicationCursor=this.applicationKeypad=this.wraparoundMode=
this.originMode=this.insertMode=this.cursorHidden=!1;this.scrollTop=0;this.scrollBottom=this.rows-1;this.curAttr=this.defAttr;this.x=this.y=0;this.charset=null;this.glevel=0;this.charsets=[null]};d.prototype.requestAnsiMode=function(a){};d.prototype.requestPrivateMode=function(a){};d.prototype.setConformanceLevel=function(a){};d.prototype.loadLEDs=function(a){};d.prototype.setCursorStyle=function(a){};d.prototype.setCharProtectionAttr=function(a){};d.prototype.restorePrivateValues=function(a){};d.prototype.setAttrInRectangle=
function(a){for(var e=a[0],b=a[1],c=a[2],d=a[3],h=a[4],f,g;e<c+1;e++)for(f=this.lines[this.ybase+e],g=b;g<d;g++)f[g]=[h,f[g][1]];this.updateRange(a[0]);this.updateRange(a[2])};d.prototype.savePrivateValues=function(a){};d.prototype.manipulateWindow=function(a){};d.prototype.reverseAttrInRectangle=function(a){};d.prototype.setTitleModeFeature=function(a){};d.prototype.setWarningBellVolume=function(a){};d.prototype.setMarginBellVolume=function(a){};d.prototype.copyRectangle=function(a){};d.prototype.enableFilterRectangle=
function(a){};d.prototype.requestParameters=function(a){};d.prototype.selectChangeExtent=function(a){};d.prototype.fillRectangle=function(a){for(var e=a[0],b=a[1],c=a[2],d=a[3],h=a[4],f,g;b<d+1;b++)for(f=this.lines[this.ybase+b],g=c;g<h;g++)f[g]=[f[g][0],t.fromCharCode(e)];this.updateRange(a[1]);this.updateRange(a[3])};d.prototype.enableLocatorReporting=function(a){};d.prototype.eraseRectangle=function(a){var e=a[0],b=a[1],c=a[2],d=a[3],h,f,g;for(g=[this.eraseAttr()," "];e<c+1;e++)for(h=this.lines[this.ybase+
e],f=b;f<d;f++)h[f]=g;this.updateRange(a[0]);this.updateRange(a[2])};d.prototype.setLocatorEvents=function(a){};d.prototype.selectiveEraseRectangle=function(a){};d.prototype.requestLocatorPosition=function(a){};d.prototype.insertColumns=function(){for(var a=params[0],e=this.ybase+this.rows,b=[this.eraseAttr()," "],c;a--;)for(c=this.ybase;c<e;c++)this.lines[c].splice(this.x+1,0,b),this.lines[c].pop();this.maxRange()};d.prototype.deleteColumns=function(){for(var a=params[0],e=this.ybase+this.rows,b=
[this.eraseAttr()," "],c;a--;)for(c=this.ybase;c<e;c++)this.lines[c].splice(this.x,1),this.lines[c].push(b);this.maxRange()};d.prototype.enterPrefix=function(){this.prefixMode=!0};d.prototype.leavePrefix=function(){this.prefixMode=!1};d.prototype.enterSelect=function(){this._real={x:this.x,y:this.y,ydisp:this.ydisp,ybase:this.ybase,cursorHidden:this.cursorHidden,lines:this.copyBuffer(this.lines),write:this.write};this.write=function(){};this.selectMode=!0;this.cursorHidden=this.visualMode=!1;this.refresh(this.y,
this.y)};d.prototype.leaveSelect=function(){this.x=this._real.x;this.y=this._real.y;this.ydisp=this._real.ydisp;this.ybase=this._real.ybase;this.cursorHidden=this._real.cursorHidden;this.lines=this._real.lines;this.write=this._real.write;delete this._real;this.visualMode=this.selectMode=!1;this.refresh(0,this.rows-1)};d.prototype.enterVisual=function(){this._real.preVisual=this.copyBuffer(this.lines);this.selectText(this.x,this.x,this.ydisp+this.y,this.ydisp+this.y);this.visualMode=!0};d.prototype.leaveVisual=
function(){this.lines=this._real.preVisual;delete this._real.preVisual;delete this._selected;this.visualMode=!1;this.refresh(0,this.rows-1)};d.prototype.enterSearch=function(a){this.entry="";this.searchMode=!0;this.searchDown=a;this._real.preSearch=this.copyBuffer(this.lines);this._real.preSearchX=this.x;this._real.preSearchY=this.y;a=this.ydisp+this.rows-1;for(var e=0;e<this.entryPrefix.length;e++)this.lines[a][e]=[this.defAttr&-512|4,this.entryPrefix[e]];this.y=this.rows-1;this.x=this.entryPrefix.length;
this.refresh(this.rows-1,this.rows-1)};d.prototype.leaveSearch=function(){this.searchMode=!1;this._real.preSearch&&(this.lines=this._real.preSearch,this.x=this._real.preSearchX,this.y=this._real.preSearchY,delete this._real.preSearch,delete this._real.preSearchX,delete this._real.preSearchY);this.refresh(this.rows-1,this.rows-1)};d.prototype.copyBuffer=function(a){a=a||this.lines;for(var e=[],b=0;b<a.length;b++){e[b]=[];for(var c=0;c<a[b].length;c++)e[b][c]=[a[b][c][0],a[b][c][1]]}return e};d.prototype.getCopyTextarea=
function(a){a=this._copyTextarea;var e=this.document;a||(a=e.createElement("textarea"),a.style.position="absolute",a.style.left="-32000px",a.style.top="-32000px",a.style.width="0px",a.style.height="0px",a.style.opacity="0",a.style.backgroundColor="transparent",a.style.borderStyle="none",a.style.outlineStyle="none",e.getElementsByTagName("body")[0].appendChild(a),this._copyTextarea=a);return a};d.prototype.copyText=function(a){var e=this,b=this.getCopyTextarea();this.emit("copy",a);b.focus();b.textContent=
a;b.value=a;b.setSelectionRange(0,a.length);v(function(){e.element.focus();e.focus()},1)};d.prototype.selectText=function(a,e,b,c){var d,h,f,g,l,k;if(this._selected){a=this._selected.x1;b=this._selected.x2;d=this._selected.y1;h=this._selected.y2;h<d&&(f=b,b=a,a=f,f=h,h=d,d=f);b<a&&d===h&&(f=b,b=a,a=f);for(g=d;g<=h;g++)for(f=0,l=this.cols-1,g===d&&(f=a),g===h&&(l=b);f<=l;f++)null!=this.lines[g][f].old&&(k=this.lines[g][f].old,delete this.lines[g][f].old,this.lines[g][f]=[k,this.lines[g][f][1]]);b=
this._selected.y1;a=this._selected.x1}b=Math.max(b,0);b=Math.min(b,this.ydisp+this.rows-1);c=Math.max(c,0);c=Math.min(c,this.ydisp+this.rows-1);this._selected={x1:a,x2:e,y1:b,y2:c};c<b&&(f=e,e=a,a=f,f=c,c=b,b=f);e<a&&b===c&&(f=e,e=a,a=f);for(g=b;g<=c;g++)for(f=0,l=this.cols-1,g===b&&(f=a),g===c&&(l=e);f<=l;f++)k=this.lines[g][f][0],this.lines[g][f]=[k&-512|261636,this.lines[g][f][1]],this.lines[g][f].old=k;b-=this.ydisp;c-=this.ydisp;b=Math.max(b,0);Math.min(b,this.rows-1);c=Math.max(c,0);Math.min(c,
this.rows-1);this.refresh(0,this.rows-1)};d.prototype.grabText=function(a,e,b,c){var d="",h="",f,g,l,k;c<b&&(f=e,e=a,a=f,f=c,c=b,b=f);e<a&&b===c&&(f=e,e=a,a=f);for(l=b;l<=c;l++){g=0;k=this.cols-1;l===b&&(g=a);for(l===c&&(k=e);g<=k;g++)f=this.lines[l][g][1]," "===f?h+=f:(h&&(d+=h,h=""),d+=f,x(f)&&g++);h="";d+="\n"}g=e;for(l=c;g<this.cols;g++)if(" "!==this.lines[l][g][1]){d=d.slice(0,-1);break}return d};d.prototype.keyPrefix=function(a,e){"k"===e||"&"===e?this.destroy():"p"===e||"]"===e?this.emit("request paste"):
"c"===e?this.emit("request create"):"0"<=e&&"9">=e?(e=+e-1,~e||(e=9),this.emit("request term",e)):"n"===e?this.emit("request term next"):"P"===e?this.emit("request term previous"):":"===e?this.emit("request command mode"):"["===e&&this.enterSelect()};d.prototype.keySelect=function(a,e){this.showCursor();if(this.searchMode||"n"===e||"N"===e)return this.keySearch(a,e);if("\u0004"===e){var b=this.ydisp+this.y;this.ydisp===this.ybase?(this.y=Math.min(this.y+(this.rows-1)/2|0,this.rows-1),this.refresh(0,
this.rows-1)):this.scrollDisp((this.rows-1)/2|0);this.visualMode&&this.selectText(this.x,this.x,b,this.ydisp+this.y)}else if("\u0015"===e)b=this.ydisp+this.y,0===this.ydisp?(this.y=Math.max(this.y-(this.rows-1)/2|0,0),this.refresh(0,this.rows-1)):this.scrollDisp(-(this.rows-1)/2|0),this.visualMode&&this.selectText(this.x,this.x,b,this.ydisp+this.y);else if("\u0006"===e)b=this.ydisp+this.y,this.scrollDisp(this.rows-1),this.visualMode&&this.selectText(this.x,this.x,b,this.ydisp+this.y);else if("\u0002"===
e)b=this.ydisp+this.y,this.scrollDisp(-(this.rows-1)),this.visualMode&&this.selectText(this.x,this.x,b,this.ydisp+this.y);else if("k"===e||"\u001b[A"===e)b=this.ydisp+this.y,this.y--,0>this.y&&(this.y=0,this.scrollDisp(-1)),this.visualMode?this.selectText(this.x,this.x,b,this.ydisp+this.y):this.refresh(this.y,this.y+1);else if("j"===e||"\u001b[B"===e)b=this.ydisp+this.y,this.y++,this.y>=this.rows&&(this.y=this.rows-1,this.scrollDisp(1)),this.visualMode?this.selectText(this.x,this.x,b,this.ydisp+this.y):
this.refresh(this.y-1,this.y);else if("h"===e||"\u001b[D"===e){var c=this.x;this.x--;0>this.x&&(this.x=0);this.visualMode?this.selectText(c,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y)}else if("l"===e||"\u001b[C"===e)c=this.x,this.x++,this.x>=this.cols&&(this.x=this.cols-1),this.visualMode?this.selectText(c,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y);else if("v"===e||" "===e)this.visualMode?this.leaveVisual():this.enterVisual();else if("y"===
e)this.visualMode&&(b=this.grabText(this._selected.x1,this._selected.x2,this._selected.y1,this._selected.y2),this.copyText(b),this.leaveVisual());else if("q"===e||"\u001b"===e)this.visualMode?this.leaveVisual():this.leaveSelect();else if("w"===e||"W"===e){for(var d=this.x,h=this.y,f=this.ydisp,c=this.x,b=this.y,g=this.ydisp,l=!1;;){for(var k=this.lines[g+b];c<this.cols;){if(" ">=k[c][1])l=!0;else if(l)break;c++}c>=this.cols&&(c=this.cols-1);if(c===this.cols-1&&" ">=k[c][1]){if(c=0,++b>=this.rows&&
(b--,++g>this.ybase)){g=this.ybase;c=this.x;break}}else break}this.x=c;this.y=b;this.scrollDisp(-this.ydisp+g);this.visualMode&&this.selectText(d,this.x,h+f,this.ydisp+this.y)}else if("b"===e||"B"===e){d=this.x;h=this.y;f=this.ydisp;c=this.x;b=this.y;for(g=this.ydisp;;){k=this.lines[g+b];for(l=0<c&&" "<k[c][1]&&" "<k[c-1][1];0<=c;){if(" ">=k[c][1])if(l&&c+1<this.cols&&" "<k[c+1][1]){c++;break}else l=!0;c--}0>c&&(c=0);if(0===c&&(" ">=k[c][1]||!l)){if(c=this.cols-1,0>--b&&(b++,0>--g)){g++;c=0;break}}else break}this.x=
c;this.y=b;this.scrollDisp(-this.ydisp+g);this.visualMode&&this.selectText(d,this.x,h+f,this.ydisp+this.y)}else if("e"===e||"E"===e){c=this.x+1;b=this.y;g=this.ydisp;for(c>=this.cols&&c--;;){for(k=this.lines[g+b];c<this.cols;)if(" ">=k[c][1])c++;else break;for(;c<this.cols;){if(" ">=k[c][1]&&0<=c-1&&" "<k[c-1][1]){c--;break}c++}c>=this.cols&&(c=this.cols-1);if(c===this.cols-1&&" ">=k[c][1]){if(c=0,++b>=this.rows&&(b--,++g>this.ybase)){g=this.ybase;break}}else break}this.x=c;this.y=b;this.scrollDisp(-this.ydisp+
g);this.visualMode&&this.selectText(d,this.x,h+f,this.ydisp+this.y)}else if("^"===e||"0"===e){d=this.x;if("0"===e)this.x=0;else if("^"===e){k=this.lines[this.ydisp+this.y];for(c=0;c<this.cols&&!(" "<k[c][1]);)c++;c>=this.cols&&(c=this.cols-1);this.x=c}this.visualMode?this.selectText(d,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y)}else if("$"===e){d=this.x;k=this.lines[this.ydisp+this.y];for(c=this.cols-1;0<=c;){if(" "<k[c][1]){this.visualMode&&c<this.cols-1&&c++;break}c--}0>
c&&(c=0);this.x=c;this.visualMode?this.selectText(d,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y)}else if("g"===e||"G"===e)d=this.x,h=this.y,f=this.ydisp,"g"===e?(this.y=this.x=0,this.scrollDisp(-this.ydisp)):"G"===e&&(this.x=0,this.y=this.rows-1,this.scrollDisp(this.ybase)),this.visualMode&&this.selectText(d,this.x,h+f,this.ydisp+this.y);else if("H"===e||"M"===e||"L"===e)d=this.x,h=this.y,"H"===e?this.y=this.x=0:"M"===e?(this.x=0,this.y=this.rows/2|0):"L"===e&&(this.x=0,
this.y=this.rows-1),this.visualMode?this.selectText(d,this.x,this.ydisp+h,this.ydisp+this.y):(this.refresh(h,h),this.refresh(this.y,this.y));else if("{"===e||"}"===e){var d=this.x,h=this.y,f=this.ydisp,l=c=!1,n=-1,b=this.y+("{"===e?-1:1),g=this.ydisp,m;"{"===e?0>b&&(b++,0<g&&g--):"}"===e&&b>=this.rows&&(b--,g<this.ybase&&g++);for(;;){k=this.lines[g+b];for(m=0;m<this.cols;m++)if(" "<k[m][1]){-1===n&&(n=0);c=!0;break}else if(m===this.cols-1){-1===n?n=1:0===n?l=!0:1===n&&c&&(l=!0);break}if(l)break;if("{"===
e){if(b--,0>b)if(b++,0<g)g--;else break}else if("}"===e&&(b++,b>=this.rows))if(b--,g<this.ybase)g++;else break}l||("{"===e?g=b=0:"}"===e&&(b=this.rows-1,g=this.ybase));this.x=0;this.y=b;this.scrollDisp(-this.ydisp+g);this.visualMode&&this.selectText(d,this.x,h+f,this.ydisp+this.y)}else if("/"===e||"?"===e)this.visualMode||this.enterSearch("/"===e);else return!1};d.prototype.keySearch=function(a,d){if("\u001b"===d)this.leaveSearch();else if("\r"!==d&&(this.searchMode||"n"!==d&&"N"!==d))if("\b"===d||
"\u007f"===d){if(0!==this.entry.length){var b=this.ydisp+this.rows-1;this.entry=this.entry.slice(0,-1);m=this.entryPrefix.length+this.entry.length;this.lines[b][m]=[this.lines[b][m][0]," "];this.x--;this.refresh(this.rows-1,this.rows-1);this.refresh(this.y,this.y)}}else if(1===d.length&&" "<=d&&"~">=d)b=this.ydisp+this.rows-1,this.entry+=d,m=this.entryPrefix.length+this.entry.length-1,this.lines[b][m]=[this.defAttr&-512|4,d],this.x++,this.refresh(this.rows-1,this.rows-1),this.refresh(this.y,this.y);
else return!1;else{this.leaveSearch();var c=this.entry;if(c){for(var b=this.x,p=this.y,h=this.ydisp,f,g=!1,l=!1,k=this.x+1,n=this.ydisp+this.y,m,q="N"===d?this.searchDown:!this.searchDown;;){for(f=this.lines[n];k<this.cols;){for(m=0;m<c.length&&!(k+m>=this.cols)&&f[k+m][1]===c[m];m++)if(f[k+m][1]===c[m]&&m===c.length-1){g=!0;break}if(g)break;k+=m+1}if(g)break;k=0;if(q){if(n--,0>n){if(l)break;l=!0;n=this.ybase+this.rows-1}}else if(n++,n>this.ybase+this.rows-1){if(l)break;l=!0;n=0}}g?(0>n-this.ybase?
(m=n,n=0,m>this.ybase&&(n=m-this.ybase,m=this.ybase)):(m=this.ybase,n-=this.ybase),this.x=k,this.y=n,this.scrollDisp(-this.ydisp+m),this.visualMode&&this.selectText(b,this.x,p+h,this.ydisp+this.y)):this.refresh(0,this.rows-1)}else this.refresh(0,this.rows-1)}};d.charsets={};d.charsets.SCLD={"`":"\u25c6",a:"\u2592",b:"\t",c:"\f",d:"\r",e:"\n",f:"\u00b0",g:"\u00b1",h:"\u2424",i:"\x0B",j:"\u2518",k:"\u2510",l:"\u250c",m:"\u2514",n:"\u253c",o:"\u23ba",p:"\u23bb",q:"\u2500",r:"\u23bc",s:"\u23bd",t:"\u251c",
u:"\u2524",v:"\u2534",w:"\u252c",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03c0","|":"\u2260","}":"\u00a3","~":"\u00b7"};d.charsets.UK=null;d.charsets.US=null;d.charsets.Dutch=null;d.charsets.Finnish=null;d.charsets.French=null;d.charsets.FrenchCanadian=null;d.charsets.German=null;d.charsets.Italian=null;d.charsets.NorwegianDanish=null;d.charsets.Spanish=null;d.charsets.Swedish=null;d.charsets.Swiss=null;d.charsets.ISOLatin=null;var t=this.String,v=this.setTimeout,C=this.setInterval;u._cache={};u.distance=
function(a,d,b,c,p,h){return Math.pow(30*(a-c),2)+Math.pow(59*(d-p),2)+Math.pow(11*(b-h),2)};d.EventEmitter=s;d.inherits=B;d.on=r;d.off=w;d.cancel=q;"undefined"!==typeof module?module.exports=d:this.Terminal=d}).call(function(){return this||("undefined"!==typeof window?window:global)}());
